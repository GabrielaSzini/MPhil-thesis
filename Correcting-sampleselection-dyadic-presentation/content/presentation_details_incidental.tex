\begin{frame}[label = Asymptotic]
    \frametitle{Incidental parameter problem}
    \cite{heckman1979sample}'s approach:
    \begin{itemize}
        \item \textbf{Stage 1:} Estimate the selection equation by MLE (probit).
        \item \textbf{Stage 2:} Obtain inverse Mills-ratio and estimate the observation equation by FGLS.
    \end{itemize} 
    \textbf{But} fixed effects estimators in nonlinear models suffer from the \textbf{incidental parameter problem} (\cite{neyman1948consistent}). 
    \\~\\
    \textbf{How does this problem arise?}\\
    $y_{2,ij,t}$ is generated by the process:
\begin{align*}
    y_{2,ij,t} \rvert x_{2,ij,t}, \xi^*, \zeta^*, \beta_2^* \sim f_{Y_2}(\cdot \rvert x_{2,ij,t}, \xi^*, \zeta^*, \beta_2^*)
\end{align*}
\noindent where: $\xi^* = (\xi_1^*, ... \xi_N^*)$, $\zeta^* = (\zeta_1^*, ... \zeta_N^*)$, $f_{Y_2}$ is a known probability function and $\xi^*_i, \zeta^*_j$ are the unobserved fixed effects.
\end{frame}

\begin{frame}
    \frametitle{Incidental parameter problem}
Using a single-index specification with fixed effects:
\begin{align}
    f_{Y_2} ( y_{2,ij,t} \rvert  x_{2,ij,t}, \xi^*, \zeta^*, \beta_2^*) &= \Phi(x_{2,ij,t}'{\beta_2^*}  +\xi_{i}^*+\zeta_{j}^*)^{y_{2,ij,t}} \nonumber\\ 
    &\times [1 - \Phi(x_{2,ij,t}'{\beta_2^*}  +\xi_{i}^*+\zeta_{j}^*)]^{1-y_{2,ij,t}}, 
    \label{eq:fy}
 \end{align}
 To estimate the parameters, we solve the sample analogue of:
\begin{align}
    \max_{(\beta_2^*, \omega_{NN}^*) \in \mathbb{R}^{\text{dim} \beta_2^* + \text{dim} \omega_{NN}^*}} \mathcal{L} (\beta_2^*, \omega_{NN}^*)
    \label{eq:val1}
\end{align}
\noindent with $\omega_{NN}^* = {(\xi_1^*, ... \xi_N^*, \zeta_1^*, ... \zeta_N^*)}'$, and:
\begin{align} \label{eq:unconditional}
    &\mathcal{L} (\beta_2^*, \omega_{NN}^*) \\ &= (N(N-1)T)^{-1} \Big\{ \sum_{i=1}^{N}\sum_{j\neq i}\sum_{t=1}^T \log f_{Y_2} ( y_{2,ij,t} \rvert  x_{2,ij,t}, \xi^*, \zeta^*, \beta_2^*) - b(\iota'_{NN} \omega_{NN}^*)^2/2 \Big\} \nonumber
\end{align}
\noindent $b>0$ is an arbitrary constant, $\iota_{NN} = (1_N', - 1_N')'$ and $1_N$ denotes a vector of ones of dimension $N$.
\end{frame}

\begin{frame}
    \frametitle{Incidental parameter problem}
For a given $\beta_2^*$, the optimal $\hat{\omega}_{NN}^*$ is:
\begin{align}
    \hat{\omega}_{NN}^*(\beta_2^*) = \argmax_{\omega_{NN}^* \in \mathbb{R}^{\text{dim} \omega_{NN}^*}} \mathcal{L} (\beta_2^*, \omega_{NN}^*)   
\end{align}
Then, the fixed effects estimator of $\beta_2^*$ and $\omega_{NN}^*$ are:
\begin{align} \label{eq:taylor}
    \hat{\beta}_2^* = \argmax_{\beta_2^* \in \mathbb{R}^{\text{dim} \beta_2^*}} \mathcal{L} (\beta_2^*, \hat{\omega}_{NN}^*(\beta_2^*))
 \end{align}
 \begin{align} \label{eq:omega}
     \hat{\omega}_{NN}^*(\beta_2^*) = \hat{\omega}_{NN}^*(\hat{\beta}_2^*)
 \end{align} 
 \textbf{The source of the problem is that the dimension of the nuisance parameters increase with sample size and their estimation converge at a slower rate than the structural parameters.}
\end{frame}

\begin{frame}
    \frametitle{Incidental parameter problem}
    Denote:
    $$\Bar{\beta}^*_2 = \argmax_{\beta^*_2 \in \mathbb{R}^{\text{dim} \beta^*_2}} \mathbb{E}_\omega \Big[\mathcal{L} (\beta^*_2, \hat{\omega}_{NN}^*(\beta^*_2)) \Big]$$
    Using an asymptotic expansion for smooth likelihoods under appropriate regularity conditions (\cite{fernandez2016individual}):
    \begin{align} \label{eq:val2}
        \Bar{\beta}_2^* = \beta_{2,0}^* + \frac{\Bar{B}_\infty}{(N-1)T} + \frac{\Bar{D}_\infty}{(N-1)T} + \text{o}_P(((N-1)T)^{-1})
    \end{align}
    For some constants $\Bar{B}_\infty$ and $\Bar{D}_\infty$. 
    By the properties of the maximum likelihood estimator:
    \begin{align}
        \sqrt{N(N-1)T} (\hat{\beta}_2^* - \Bar{\beta}_2^*) \xrightarrow{d} N(0, \Bar{V_B}_\infty)
    \end{align}
    For some $\Bar{V_B}_\infty$. By Slutsky Theorem:
    \begin{align} \label{eq:val3}
        \sqrt{N(N-1)T} (\hat{\beta}_2^* - \beta_{2,0}^*) \xrightarrow{d} N\Big( \frac{\Bar{B}_\infty}{\sqrt{T}} + \frac{\Bar{D}_\infty}{\sqrt{T}}, \Bar{V_B}_\infty\Big) \nonumber
    \end{align}
\end{frame}

\begin{frame}
    \frametitle{Incidental parameter problem: asymptotic expansion}
    Taking a first-order Taylor expansion of the first order conditions of Equation (\ref{eq:taylor}) around $\beta_{2,0}^*$, gives:
    \begin{align} 
     0 &= \frac{\partial \mathcal{L} (\hat{\beta}_2^*, \hat{\omega}_{NN}^*(\beta_2^*))}{\partial_{\beta_2^*}}  \approx \frac{\partial \mathcal{L} ({\beta}_{2,0}^*, \hat{\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_2^*}} \nonumber \\
     &- \Bar{W}_\infty \sqrt{N(N-1)T} (\hat{\beta}_2^* - \beta_{2,0}^*)
    \end{align}
    
    Then, we apply a second-order Taylor expansion to approximate the above term $\frac{\partial  \mathcal{L} ({\beta}_{2,0}^*, \hat{\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_2^*}}$ around $\omega_{NN}^*(\beta_{2,0}^*)$, such that the estimates of the fixed effects are taken into account.
    \begin{align}
        &\frac{\partial \mathcal{L} ({\beta}_{2,0}^*, \hat{\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_{2}^*}}  \approx \frac{\partial \mathcal{L} ({\beta}_{2,0}^*, {\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_{2}^*} } \\
        &+ \frac{\partial^2 \mathcal{L} ({\beta}_{2,0}^*, {\omega}_{NN}^*(\beta_{2,0}^*)) }{\partial_{\beta_{2}^*} \partial_{\omega_{NN}'} }[ \hat{\omega}_{NN}^* (\beta_{2,0}^*) - \omega_{NN}^* (\beta_{2,0}^*)]  \nonumber\\
        &+ \sum_{k = 1}^{\text{dim } \omega_{NN}} \frac{\partial^3 \mathcal{L} ({\beta}_{2,0}^*, {\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_{2}^*} \partial_{\omega_{NN}'} \partial_{\omega_{NN,k}}}[ \hat{\omega}_{NN}^* (\beta_{2,0}^*) - \omega_{NN}^* (\beta_{2,0}^*)] [ \hat{\omega}_{NN,k}^* (\beta_{2,0}^*) - \omega_{NN,k}^* (\beta_{2,0}^*)] / 2 \nonumber
    \end{align}
\end{frame}
    
\begin{frame}
        \frametitle{Incidental parameter problem: asymptotic expansion}
    Under regularity conditions, since the first term in this expression is the score vector, it has mean zero and it generates the asymptotic variance. By the information matrix equality and the Central Limit Theorem, we have:
    \begin{align} \label{eq:exp_1}
        \frac{\partial \mathcal{L} ({\beta}_{2,0}^*, {\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_{2}^*} }  \xrightarrow{d} N(0, \bar{W}_\infty)
    \end{align}
    
    For some variance $\bar{W}_\infty$. According \cite{fernandez2016individual}, the second and the third term satisfies:
    \begin{align} \label{eq:exp_2}
        &\frac{\partial^2 \mathcal{L} ({\beta}_{2,0}^*, {\omega}_{NN}^*(\beta_{2,0}^*)) }{\partial_{\beta_{2}^*}\partial_{\omega_{NN}'} }[ \hat{\omega}_{NN}^* (\beta_{2,0}^*) - \omega_{NN}^* (\beta_{2,0}^*)]  \nonumber\\
        &+ \sum_{k = 1}^{\text{dim } \omega_{NN}} \frac{\partial^3 \mathcal{L} ({\beta}_{2,0}^*, {\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_{2}^*}\partial_{\omega_{NN}'}\partial_{\omega_{NN,k}}}[ \hat{\omega}_{NN}^* (\beta_{2,0}^*) - \omega_{NN}^* (\beta_{2,0}^*)] [ \hat{\omega}_{NN,k}^* (\beta_{2,0}^*) - \omega_{NN,k}^* (\beta_{2,0}^*)] / 2 \nonumber \\
        & \approx \sqrt{N(N-1)T} \Big( \frac{\bar{B}^\beta_\infty}{(N-1)T} + \frac{\bar{D}^\beta_\infty}{(N-1)T} \Big)
    \end{align}
\end{frame}

\begin{frame}
        \frametitle{Incidental parameter problem: asymptotic expansion}
    The analytical form of terms $\bar{B}^\beta_\infty$ and $\bar{D}^\beta_\infty$ can be obtained from the second-order Taylor expansion as shown in \cite{fernandez2016individual}. Those terms originate from elements corresponding to the two-way fixed effects.
    
    Plugging in the expression (\ref{eq:exp_2}) into the equation for the first-order Taylor expansion, we have, as $N \xrightarrow{}Â \infty$:
    \begin{align}
        \Bar{W}_\infty \sqrt{N(N-1)T} (\hat{\beta}_2^* - \beta_{2,0}^*) = \frac{\partial \mathcal{L} ({\beta}_{2,0}^*, {\omega}_{NN}^*(\beta_{2,0}^*))}{\partial_{\beta_{2}^*} }  + \frac{\bar{B}^\beta_\infty}{\sqrt{T}} + \frac{\bar{D}^\beta_\infty}{\sqrt{T}} 
    \end{align}
    
    By Slutsky Theorem, we have, given (\ref{eq:exp_1}):
    \begin{align}
        \sqrt{N(N-1)T} (\hat{\beta}_2^* - \beta_{2,0}^*) \xrightarrow{d} \Bar{W}_\infty^{-1} N \Big(\frac{\bar{B}^\beta_\infty}{\sqrt{T}} + \frac{\bar{D}^\beta_\infty}{\sqrt{T}} , \Bar{W}_\infty \Big)
    \end{align}
    
    Therefore, compared to the expression given in the presentation, we have that:
    $$ \Bar{W}_\infty^{-1} \bar{B}^\beta_\infty = \bar{B}_\infty  $$
    $$ \Bar{W}_\infty^{-1} \bar{D}^\beta_\infty =  \bar{D}_\infty  $$
    
\end{frame}
